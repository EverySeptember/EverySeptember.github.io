<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="lu"><title>数据库-Elasticsearch-映射 · 这里是lu</title><meta name="description" content="映射动态映射自动检测和添加新字段的做法被称为动态映射。通过将dynamic设置为true或runtime来启用动态映射。
动态字段映射当Elasticsearch检测到文档中出现新字段时，会根据当前配置动态参数为true或者runtime的不同，按照下表规则映射为不同的数据类型。



JSON数据"><meta name="keywords" content="lu的博客"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">这里是lu</a></h3><div class="description"><p>心之所愿，无事不成。<br> Nothing is impossible to a willing heart.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/EverySeptember"><i class="fa fa-github"></i></a></li></ul><div class="footer"><div class="p"> <span>©  </span><i class="fa fa-star"></i><span> lu</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>数据库-Elasticsearch-映射</a></h3></div><div class="post-content"><h1 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h1><h2 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a>动态映射</h2><p>自动检测和添加新字段的做法被称为动态映射。通过将<code>dynamic</code>设置为<code>true</code>或<code>runtime</code>来启用动态映射。</p>
<h3 id="动态字段映射"><a href="#动态字段映射" class="headerlink" title="动态字段映射"></a>动态字段映射</h3><p>当Elasticsearch检测到文档中出现新字段时，会根据当前配置动态参数为true或者runtime的不同，按照下表规则映射为不同的数据类型。</p>
<table>
<thead>
<tr>
<th>JSON数据类型</th>
<th>dynamic: true</th>
<th>dynamic: runtime</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>不添加字段</td>
<td>不添加字段</td>
</tr>
<tr>
<td>true或者false</td>
<td>boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>double</td>
<td>float</td>
<td>double</td>
</tr>
<tr>
<td>integer</td>
<td>long</td>
<td>long</td>
</tr>
<tr>
<td>object</td>
<td>object</td>
<td>object</td>
</tr>
<tr>
<td>array</td>
<td>取决于数组中第一个非空值的类型</td>
<td>取决于数组中第一个非空值的类型</td>
</tr>
<tr>
<td>通过日期检测的string</td>
<td>date</td>
<td>date</td>
</tr>
<tr>
<td>通过数字检测的string</td>
<td>float或者long</td>
<td>double或者long</td>
</tr>
<tr>
<td>没有通过日期检测与数字检测的string</td>
<td>带有.keyword子域的text</td>
<td>keyword</td>
</tr>
</tbody></table>
<p>若将dynamic设置为false，出现新的字段，则会拒绝该文档。</p>
<h3 id="日期检测"><a href="#日期检测" class="headerlink" title="日期检测"></a>日期检测</h3><p>需设置date_detection属性为true（默认）；若设置为false，则字段会被映射为文本类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT my-index-000001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;date_detection&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认值为[<code>&quot;strict_date_optional_time&quot;</code>,<code>&quot;yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z&quot;</code>]，满足该表达式的字段将被映射为日期类型（<code>strict_date_optional_time</code>为是一个通用的ISO日期时间分析器，至少包含年份，时间可选，日期与时间之间使用’T’分割）</p>
<h4 id="自定义检测格式"><a href="#自定义检测格式" class="headerlink" title="自定义检测格式"></a>自定义检测格式</h4><p>修改<code>dynamic_date_formats</code>属性，添加或删减规则</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT my-index-000001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;dynamic_date_formats&quot;: [&quot;strict_date_optional_time&quot;,&quot;yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z&quot;,&quot;MM/dd/yyyy&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数组检测"><a href="#数组检测" class="headerlink" title="数组检测"></a>数组检测</h3><p>默认禁用，可以通过设置来启用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT my-index-000001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;numeric_detection&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该检测将自动区分整形、浮点型和字符</p>
<h2 id="动态模板"><a href="#动态模板" class="headerlink" title="动态模板"></a>动态模板</h2><p>使用动态模板可以在默认的规则之外自定义映射规则。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;模板名称&quot;</span>: &#123;</span><br><span class="line">      ... 匹配条件 ... </span><br><span class="line">      <span class="attr">&quot;mapping&quot;</span>: &#123; ... &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>match_mapping_type</code>匹配Elasticsearch检测到的数据类型。</li>
<li><code>match</code>和<code>unmatch</code>使用一个模式来匹配字段名。</li>
<li><code>path_match</code>和<code>path_unmatch</code>对字段的完整点状路径进行操作。</li>
</ul>
<p>模板是按照定义顺序处理的，当匹配到第一个匹配模板时将不再继续。</p>
<h2 id="显式映射"><a href="#显式映射" class="headerlink" title="显式映射"></a>显式映射</h2></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2021-06-29</span><i class="fa fa-tag"></i><a class="tag" href="/tags/数据库/" title="数据库">数据库 </a><a class="tag" href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch </a><span class="leancloud_visitors"></span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2021/06/28/%E6%95%B0%E6%8D%AE%E5%BA%93-Elasticsearch-%E7%AE%80%E4%BB%8B/" title="数据库-Elasticsearch-简介">下一篇</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/baidu-tongji.js"></script></body></html>