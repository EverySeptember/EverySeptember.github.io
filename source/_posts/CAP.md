---
title: CAP
date: 2021-5-19 15:15:50
tags: [基础知识]
---

# CAP

## 定义

- **C**onsistency(一致性)
- **A**Vailability(可用性)
- **P**artition tolerance(分区容错性)

一致性指在同一时间所有节点,获取到的数据完全一致(强一致性).

可用性指服务每次请求都能得到非错的响应(即正常的业务响应,而不是来自网络或系统异常处理的响应).

分区容错性指对在系统分区后,部分(一个或多个节点)挂掉或发生信息丢失,不影响系统整体运行(保证系统一致性或可用性其一).// 或者直接理解P为对系统进行分区

## 论证

假设有两个节点:A和B对外提供服务,客户端发起请求调用节点A,将数据V0更新为V1,节点A将数据V1同步至节点B.此时客户端发起请求数据V,从A与B得到相同的数据V1.此为正常情况.

若当节点A与B之间网络发生异常,即为分区错误,节点A不能正常将数据同步至节点B,客户端发起请求数据V,系统便需要进行取舍:

- 若要保证所有节点都可以获取到数据V1,即选择**C**(一致性),则节点B需一直进行等待数据同步直至网络超时,系统不可用,不满足**A**(可用性).
- 若要保证系统立即返回响应,即满足**A**(可用性),则节点B无法获得数据V1,只能返回旧数据V0,不满足**C**(一致性).

若想要同时满足**C**(一致性)和**A**(可用性),需保证不发生分区错误,但事实上无法满足分区下的网络异常,所以不进行分区才能满足该条件,此时便无法满足**P**(分区容错性).

## CAP权衡

### CA

选择**C**(一致性)和**A**(可用性),即不对系统进行分区,事实上放弃了分布式,因此多为单体系统或分布式子系统

### CP

选择**C**(一致性)和**P**(分区容错性),保证数据的强一致,不保证系统时时刻用,多见于金融等对数据一致性较高的行业

### AP

选择**A**(可用性)和**P**(分区容错性),常见于对消息实时性不高的系统,如微博微信朋友圈等消息流

