---
title: MySQL调优-基础知识
date: 2019-5-26 15:10:13
tags: [数据库, MySQL, 基础知识]
---
# 影响MySQL性能的主要因素

- 数据库结构设计
- 数据库存储引擎
- SQL语句的书写
- 数据库参数配置
- 服务器系统和硬件

# 数据库结构设计

## 三范式

1. 数据库中每个字段只包含一个独立且不可拆分的属性
2. 满足第一范式，必须有一个主键，且其他字段必须与主键有关系
3. 满足第二范式，所有字段与主键直接相关，而不是间接相关

### 反范式设计

表设计不一定完全按照范式进行设计，在特定情况下可根据业务需求进行一些反范式的设计。

#### 优点

1. 单表查询易于优化，益于管理
2. SQL语句简单，有利于程序开发

#### 缺点

1. 存在数据冗余，写操作时需要额外更新从表数据
2. 不合理的反范式设计会让表变得臃肿

## 实体关系分析

- 实体关系是指系统事物之间的联系
- 实体关系需要双向分析
- 实体关系决定表关系

### 表关系设计原则

- 一对一，通过主键关联
- 一对多，在多的一方设置外键
- 多对多，增加中间表，持有双方外键

## 自然主键与代理主键

- 自然主键是指事务属性中的自然唯一标示
- 代理主键是指与业务无关的，无意义的数字序列值
- 表设计时，优先推荐代理主键，不推荐自然主键

## 数据类型的选择

### 字段类型优先级

1. 数字类型
2. 日期类型与二进制类型
3. 字符串类型

### 整数类型

| 列类型    | 存储空间 | SIGNED                                     | UNSIGNED                 |
| --------- | -------- | ------------------------------------------ | ------------------------ |
| tinyint   | 1字节    | -128 ~ 127                                 | 0 ~ 255                  |
| smallint  | 2字节    | -32768 ~ 32767                             | 0 ~ 65536                |
| mediumint | 3字节    | -8388608 ~ 8388607                         | 0 ~ 16777215             |
| int       | 4字节    | -2147483648 ~ 2147483647                   | 0 ~ 4294967295           |
| bigint    | 8字节    | -9223372036854775808 ~ 9223372036854775807 | 0 ~ 18446744073709551615 |

### 实数类型

| 列类型  | 存储空间                             | 是否精确类型 |
| ------- | ------------------------------------ | ------------ |
| FLOAT   | 4字节                                | 否           |
| DOUBLE  | 8字节                                | 否           |
| DECIMAL | 每4个字节存9个数字，小数点占一个字节 | 是           |

财务数据一定要使用DECIMAL

### VARCHAR类型

VARCHAR表示变体长度，根据实际内容保存数据

1. 尽量使用最小的符合需求的长度
2. VARCHAR(255)以下使用额外一个字节保存实际内容长度，VARCHAR(255)以上额外使用两个字节保存实际内容长度；所以255是一个常见的长度分水岭
3. 虽然在磁盘存储的角度上，VARCHAR(5)与VARCHAR(200)实际存储内容长度可能相同，但内存占用不同，长度越长需要占用的内存越多
4. VARCHAR变更长度时会出现锁表

#### VARCHAR的适用场景

- VARCHAR适合存储长度波动大的数据（如博客文章）
- 字符串很少被更新的场景
- VARCHAR适合保存多字节字符

### CHAR类型

- CHAR属于定长数据
- CHAR最大长度255
- CHAR类型会自动删除末尾的空格
- CHAR类型检索效率比VARCHAR高

#### CHAR的适用场景

- CHAR适合存储长度波动不大的数据，如MD5
- CHAR适合存储短字符串
- CHAR适合存储经常更新的字符串

### DATETIME类型

- 占用8个字节
- 与时区无关
- 可保存到毫秒
- 可保存时间范围大

### TIMESTAMP时间戳类型

- 占用4个字节
- 时间范围：1970-01-01到2038-01-19
- 精确到秒
- 采用整型存储
- 依赖于时区
- 自动更新timestamp列值